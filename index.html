<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>공지 이미지 생성기</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      padding: 2rem;
      background: #f5f5f5;
    }
    .container {
      background: #fff;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      max-width: 500px;
      margin: auto;
    }
    input, textarea {
      width: 100%;
      margin-bottom: 1rem;
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 0.5rem;
    }
    button {
      padding: 0.7rem 1.2rem;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }
    #preview {
      margin-top: 2rem;
      border: 1px solid #ccc;
      padding: 1rem;
      background: white;
      position: relative;
      text-align: center;
    }
    .btn-area {
      text-align: center;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>공지 이미지 생성기</h2>
    <label>제목:</label>
    <input type="text" id="title" placeholder="공지 제목을 입력하세요" />

    <label>본문 내용:</label>
    <textarea id="body" rows="4" placeholder="공지 내용을 입력하세요"></textarea>

    <label>버튼명:</label>
    <input type="text" id="buttonText" placeholder="버튼 텍스트" />

    <label>버튼 링크:</label>
    <input type="text" id="buttonLink" placeholder="https://" />

    <div class="btn-area">
      <button onclick="generatePreview()">미리보기 생성</button>
      <button onclick="downloadImage()">이미지 다운로드</button>
    </div>

    <div id="preview">
      <h2 id="preview-title"></h2>
      <p id="preview-body"></p>
      <a id="preview-button" href="#" target="_blank" style="display:inline-block;margin-top:1rem;padding:0.5rem 1rem;background:#007bff;color:#fff;text-decoration:none;border-radius:0.5rem;">버튼</a>
    </div>

    <textarea id="generatedCode" rows="8" readonly style="margin-top:2rem;width:100%;"></textarea>
  </div>

  <script>
    function generatePreview() {
      const title = document.getElementById('title').value;
      const body = document.getElementById('body').value;
      const buttonText = document.getElementById('buttonText').value;
      const buttonLink = document.getElementById('buttonLink').value;

      document.getElementById('preview-title').innerText = title;
      document.getElementById('preview-body').innerText = body;
      const btn = document.getElementById('preview-button');
      btn.innerText = buttonText;
      btn.href = buttonLink;

      setTimeout(() => {
        html2canvas(document.querySelector("#preview")).then(canvas => {
          const base64image = canvas.toDataURL("image/png");
          const coords = getButtonCoords(btn, canvas);
          const mapId = "map01";

          const htmlCode = `
<img src="/classic/cmn/commInfo/getNoticeImage.do?file=branding/notice_20250415_1.png" style="width: ${canvas.width}px; height: auto;" usemap="#${mapId}"/>
<map name="${mapId}" id="${mapId}">
  <area shape="rect" coords="${coords}" href="${buttonLink}" alt="${buttonText}" target="_blank" style="outline: none;">
</map>`;
          document.getElementById("generatedCode").value = htmlCode;
        });
      }, 100);
    }

    function getButtonCoords(button, canvas) {
      const rect = button.getBoundingClientRect();
      const containerRect = document.getElementById('preview').getBoundingClientRect();
      const scale = canvas.width / containerRect.width;

      const x1 = Math.round((rect.left - containerRect.left) * scale);
      const y1 = Math.round((rect.top - containerRect.top) * scale);
      const x2 = Math.round((rect.right - containerRect.left) * scale);
      const y2 = Math.round((rect.bottom - containerRect.top) * scale);

      return `${x1},${y1},${x2},${y2}`;
    }

    function downloadImage() {
      html2canvas(document.querySelector("#preview")).then(canvas => {
        const link = document.createElement("a");
        link.download = "notice.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    }
  </script>
</body>
</html>
